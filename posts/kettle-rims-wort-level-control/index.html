<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Kettle-RIMS wort level control" /><meta name="author" content="Vito" /><meta property="og:locale" content="en" /><meta name="description" content="About homebrewing." /><meta property="og:description" content="About homebrewing." /><link rel="canonical" href="https://www.vito.tw/posts/kettle-rims-wort-level-control/" /><meta property="og:url" content="https://www.vito.tw/posts/kettle-rims-wort-level-control/" /><meta property="og:site_name" content="Vito’s" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-08-07T02:18:53+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kettle-RIMS wort level control" /><meta name="twitter:site" content="@vitotai" /><meta name="twitter:creator" content="@Vito" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Vito"},"dateModified":"2025-03-11T00:46:58+00:00","datePublished":"2018-08-07T02:18:53+00:00","description":"About homebrewing.","headline":"Kettle-RIMS wort level control","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.vito.tw/posts/kettle-rims-wort-level-control/"},"url":"https://www.vito.tw/posts/kettle-rims-wort-level-control/"}</script><title>Kettle-RIMS wort level control | Vito's</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vito's"><meta name="application-name" content="Vito's"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/img/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">Vito's</a></div><div class="site-subtitle fst-italic">irresponsible writings</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/links/" class="nav-link"> <i class="fa-fw fas fa-asterisk"></i> <span>小工具&PROJECTS</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/vitotai" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/vitotai" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Kettle-RIMS wort level control</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Kettle-RIMS wort level control</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1533608333" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 7, 2018 </em> </span> <span> Updated <em class="" data-ts="1741654018" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 11, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="634 words" > <em>3 min</em> read</span></div></div></div><div class="post-content"><p><a href="/wp-content/uploads/2018/08/kettle-rims-level.png" class="popup img-link "><img data-src="/wp-content/uploads/2018/08/kettle-rims-level.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="preface"><span class="me-2">Preface</span><a href="#preface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The operation of Kettle-RIMS is like a E-BIAB system with its “basket” outside of boil kettle. The advantages of Kettle-RIMS over BIAB are</p><ul><li>Less hot side aeration. The wort drains smoothly into BK without splashing.<li>No need of lifting the hot heavy “bag/basket”. The “basket” is already lifted.</ul><p>One issue, however, must be addressed: overflow of MLT. The wort is pumped from BK to MLT and then drains through grain bed, back to BK. It’s difficult, if not impossible, to get a matched flow rate. The flow rate through grain bed even changes as the status of mash changes. <strong><em>Overflow drain or</em> <a href="https://www.blichmannengineering.com/products/autosparge">AutoSparge by Blichmann</a> are solutions for it</strong>. BrewManiacEx adapts more software-y way by using a level sensor, or float ball, to detect potential overflow of HLT.</p><h2 id="operation"><span class="me-2">Operation</span><a href="#operation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>To support level sensor, the option “EnableLevelSensor” must be set to true. There will be three additional settings in “Misc” category. They are</p><ul><li><strong>Enable LV Sen</strong> (Enable Level Sensor)<ul><li>what it literally means. You might sometimes just don’t need the sensor.</ul><li><strong>LV Trig. ms</strong> (Level sensor minimum triggering time)<ul><li>The minimum time for BrewManiacEx to recognize the condition of “full”. This setting prevents false alarm but introduces latency.<li>step by 50ms, range 50ms~ 1000ms(1 second)</ul><li><strong>Ext pump Rest</strong> (Extended pump rest)<ul><li>The Rest state will be extended for a period of time after the “full” condition is cleared.<li>2 ~ 90 seconds</ul></ul><p>When BrewManiacEx detects “full” signal, it waits for <strong>LV Trig. ms</strong> to recognize the “full” condition. If the signal is cleared before <strong>LV Trig. ms</strong>, nothing will happen. Otherwise, BrewManiacEx enters REST state and stops Pump as well as Heating. BrewManiacEx extends the REST state for <strong>Ext pump Rest</strong> time after the “full” signal is cleared.<br /> <a href="/wp-content/uploads/2018/08/levelsensor-for-k-rim.png" class="popup img-link "><img data-src="/wp-content/uploads/2018/08/levelsensor-for-k-rim.png" alt="" class="lazyload" data-proofer-ignore></a></p><h2 id="hardwaresoftware-configuration"><span class="me-2">Hardware/Software Configuration</span><a href="#hardwaresoftware-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Of course, you must know your hardware setup and config the software accordingly.The sensor I will use is like <a href="https://www.amazon.com/uxcell-Aquarium-Stainless-Horizontal-Switch/dp/B00AQYXP0C/ref=sr_1_19?ie=UTF8&amp;qid=1533602313&amp;sr=8-19&amp;keywords=water+level+sensor">this one</a>. (But, mine isn’t from Amazon.) <em>It “opens” when triggered and “closes” when not triggered</em>. The two signal lines are connected to GROUND and the signal PIN. The reading from the signal PIN should be 1/HIGH/NOT-GROUNDED when it is triggered.<br /> The signal PIN can be native ESP8266 pins or IO pins of PCF8574. The code is in pins.h has both configurations, but the correct setup depends on the real hardware.<br /> One thing to remember is that <strong><em>D3/D4/D15 must be HIGH/HIGH/LOW</em></strong> during booting.<br /> If one of these 3 PINs is chosen, the sensor might prevent ESP8266 to boot-up. A solution is to connect the sensor after booting up. However, it’s not a good idea.<br /> If the signal PIN is on PCF8574, the interrupt PIN to D3 must be disconnected. The interrupt PIN connection in BrewShield is for BrewPiLess only, it turns out to be a design flaw. It seems that PCF8574 initialized all PINS to HIGH at initial. If one of the PIN is GROUNDED at boot-up, PCF8574 regards it as a change and signal interrupt by pulling it to LOW. Pulling D3 to LOW prevents ESP8266 to boot-up. If for some reason, ESP8266 boots quicker than PCF8574, it might be fine, which is the case in my prototype setup.<br /> Enable the option:</p><blockquote><p>[env:nodemcuv2-multisensor]<br /> platform = espressif8266<br /> board = nodemcuv2<br /> framework = arduino<br /> build_flags = -Wl,-Tesp8266.flash.4m.ld -DEnableMultiSensor<br /> -DPUMP_INVERTED_LOGIC=true<br /> -D<strong>EnableLevelSensor=true</strong></p></blockquote><p>Using D5 as the signal pin, a “<strong>normal-close</strong>” float sensor which closes when not triggered.<br /> line 56@pins.h</p><blockquote><p>#if EnableLevelSensor<br /> #define LevelSensorOnIoExpander <strong>false</strong><br /> #if LevelSensorOnIoExpander<br /> #define LevelSensorIOExpPin 32 //P5<br /> #else<br /> #define LevelSensorPin <strong>NODEMCU_PIN_D5</strong><br /> #endif</p></blockquote><p>line 213@pins.h</p><blockquote><p>bool isWaterLevelFull(void){<br /> return digitalRead(LevelSensorPin) <strong>!=</strong> 0;<br /> }</p></blockquote><p>Using P5 of PCF8574 as the signal pin, a “<strong>normal-close</strong>” float sensor which closes when not triggered.<br /> line 56@pins.h</p><blockquote><p>#if EnableLevelSensor<br /> #define LevelSensorOnIoExpander <strong>true</strong><br /> #if LevelSensorOnIoExpander<br /> #define LevelSensorIOExpPin <strong>32</strong> //P5<br /> #else<br /> #define LevelSensorPin NODEMCU_PIN_D5<br /> #endif</p></blockquote><p>line 207@pins.h</p><blockquote><p>bool isWaterLevelFull(void){<br /> // _portvalue is read for button every loop cycle<br /> return (_portvalue &amp; LevelSensorIOExpPin) <strong>!=</strong>0;<br /> }</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/brewmaniac/'>BrewManiac</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Kettle-RIMS%20wort%20level%20control%20-%20Vito's&url=https%3A%2F%2Fwww.vito.tw%2Fposts%2Fkettle-rims-wort-level-control%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Kettle-RIMS%20wort%20level%20control%20-%20Vito's&u=https%3A%2F%2Fwww.vito.tw%2Fposts%2Fkettle-rims-wort-level-control%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.vito.tw%2Fposts%2Fkettle-rims-wort-level-control%2F&text=Kettle-RIMS%20wort%20level%20control%20-%20Vito's" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/Silvia-GaggiMate-mod-0/">Rancilio Silvia改GaggiMate記錄</a><li class="text-truncate lh-lg"> <a href="/posts/SakeMeasurement/">清酒的量測</a><li class="text-truncate lh-lg"> <a href="/posts/pycnometer/">比重瓶</a><li class="text-truncate lh-lg"> <a href="/posts/sake_recipes/">清酒釀造例範</a><li class="text-truncate lh-lg"> <a href="/posts/SakeBrewing/">清酒釀造</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/brewpiless/">brewpiless</a> <a class="post-tag btn btn-outline-primary" href="/tags/candi-sugar/">candi-sugar</a> <a class="post-tag btn btn-outline-primary" href="/tags/kveik/">kveik</a> <a class="post-tag btn btn-outline-primary" href="/tags/fft/">FFT</a> <a class="post-tag btn btn-outline-primary" href="/tags/homebrew/">Homebrew</a> <a class="post-tag btn btn-outline-primary" href="/tags/open-ardbir-arduino/">Open ArdBir Arduino</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%91%BD%E5%90%8D%E5%A4%A7%E5%B8%AB/">命名大師</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%AE%B6%E9%87%80/">家釀</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E8%87%AA%E9%87%80/">自釀</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/lcd-and-hardware-configuration-of-brewmaniacex/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1484081373" data-df="ll" > Jan 10, 2017 </em><h4 class="pt-0 my-2" data-toc-skip>LCD and Hardware Configuration of BrewManiacEx</h4><div class="text-muted small"><p> Hardware configuration There are three files you might need to check if you are not using default settings. config.h Most software configuration is defined here. The most important one is th...</p></div></div></a></div><div class="col"> <a href="/posts/brewmaniacex-v0-1-2/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1484975004" data-df="ll" > Jan 21, 2017 </em><h4 class="pt-0 my-2" data-toc-skip>BrewManiacEx v0.1.2</h4><div class="text-muted small"><p> This release is to enable BrewManiacEx to work under AP mode, so that you can use it without an Access Point. It also fixes a bug which will result in RESET of system if the connected network disap...</p></div></div></a></div><div class="col"> <a href="/posts/a-facebook-page-for-brewmaniacex-and-my-future-plan/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1485057325" data-df="ll" > Jan 22, 2017 </em><h4 class="pt-0 my-2" data-toc-skip>A Facebook page for BrewManiacEx and my future plan</h4><div class="text-muted small"><p> I have been develop BrewManiacEx myself, but I am not alone. Although most of the features are design to fit my own requirements, some of them are from discussions with readers of this blog. I appr...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/brewmaniacex-v0-4-and-v0-4-2/" class="btn btn-outline-primary" prompt="Older" ><p>BrewManiacEx v0.4 and v0.4.2</p></a> <a href="/posts/e690b6e69591e78886e793b6e5a4a7e4bd9ce688b0/" class="btn btn-outline-primary" prompt="Newer" ><p>搶救爆瓶大作戰</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/brewpiless/">brewpiless</a> <a class="post-tag btn btn-outline-primary" href="/tags/candi-sugar/">candi-sugar</a> <a class="post-tag btn btn-outline-primary" href="/tags/kveik/">kveik</a> <a class="post-tag btn btn-outline-primary" href="/tags/fft/">FFT</a> <a class="post-tag btn btn-outline-primary" href="/tags/homebrew/">Homebrew</a> <a class="post-tag btn btn-outline-primary" href="/tags/open-ardbir-arduino/">Open ArdBir Arduino</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%91%BD%E5%90%8D%E5%A4%A7%E5%B8%AB/">命名大師</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E5%AE%B6%E9%87%80/">家釀</a> <a class="post-tag btn btn-outline-primary" href="/tags/%E8%87%AA%E9%87%80/">自釀</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p><p>© 2025 <a href="https://twitter.com/vitotai">Vito Tai</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/unregister.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
